<!-- Container-fluid starts-->
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-12">
            <div class="card">
                <div class="card-body">
                    <!-- <ngb-datepicker #dp (dateSelect)="onDateSelection($event); filterDataByDate()" [displayMonths]="2" [dayTemplate]="t" outsideDays="hidden">
                    </ngb-datepicker>
                    
                    <ng-template #t let-date let-focused="focused">
                      <span class="custom-day"
                            [class.focused]="focused"
                            [class.range]="isRange(date)"
                            [class.faded]="isHovered(date) || isInside(date)"
                            (mouseenter)="hoveredDate = date"
                            (mouseleave)="hoveredDate = null">
                        {{ date.day }}
                      </span>
                    </ng-template> -->
                    <!-- <label class="mx-2">As on date:<div class="form-group">
                      <div class="input-group">
                        <input class="form-control" placeholder="yyyy-mm-dd"
                               name="d" [(ngModel)]="fromDate" ngbDatepicker #d="ngbDatepicker">
                        <div class="input-group-append">
                          <button class="btn btn-outline-secondary calendar" (click)="d.toggle()" type="button"></button>
                        </div>
                      </div>
                    </div>
                   </label> -->
                    <!-- <label class="mx-2">To date:
                      <div class="form-group">
                      <div class="input-group">
                        <input class="form-control" placeholder="yyyy-mm-dd"
                               name="td" [(ngModel)]="toDate" ngbDatepicker #t="ngbDatepicker">
                        <div class="input-group-append">
                          <button class="btn btn-outline-secondary calendar" (click)="t.toggle()" type="button"></button>
                        </div>
                      </div>
                    </div>
                  </label> -->
                    <!-- <button class="btn btn-warning" (click)="filterDataByDate()">Submit</button> -->
                    <div class="custom-datatable">
                        
                        <!-- <input type='text' class="filter-ngx form-control" placeholder='Search...'
                            (keyup)='updateFilter($event)' />
                            <button class="pull-right btn btn-warning" (click)="exportAsXLSX()">Download</button><br><br> -->
                        
                        <!-- <select name="ordersFilter" (change)="filterOrders($event.target.value)">
                            <option>All orders</option>
                            <option>Primary order</option>
                            <option>Renewal order</option>
                            <option>Replacement order</option>
                            <option>Return order</option>
                        </select> -->
                        <!-- <table class="table table-striped table-bordered" >
                          <thead>
                            <tr>
                              <th>Primary Order Id</th>
                              <th>Customer name</th>
                              <th>Mobile</th>
                              <th>Prod name</th>
                              <th>asset Id</th>
                              <th>Rent/ Mo</th>
                              <th>Start date</th>
                              <th>End date</th>
                            </tr>
                          </thead>
                          <tbody *ngFor="let o of filteredOrderItems">
                            <tr >
                              <td [routerLink]="['../../sales/orders',o.order_id]">{{o.order_id}}</td>
                              <td [routerLink]="['../../users/customers',o.customer_id]">{{o.firstName}}</td>
                              <td [routerLink]="['../../users/customers',o.customer_id]">{{o.mobile}}</td>
                              <td>{{o.prod_name}}</td> 
                              <td>{{o.asset_id}}</td> 
                              <td>{{o.renewal_price}}</td>
                              <td>{{o.start_date | date: 'dd MM yyyy'}}</td>    
                              <td>{{o.end_date | date: 'dd MM yyyy'}}</td>                      
                            </tr>                          
                          </tbody>
                        </table> -->

                        <p-table #dt1 [columns]="cols" (onPage)="onPagination($event)" (onSort)="onSort($event)"  (onFilter)="onFilter($event)" styleClass="p-datatable-gridlines" selectionMode="multiple" [(selection)]="selectedOrders" [exportHeader]="'customExportHeader'" [value]="filteredOrderItems" [lazy]="false"  responsiveLayout="scroll" dataKey="id"                            
                            [paginator]="true" [showCurrentPageReport]="true" [rowsPerPageOptions]="[30,50,100]" currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" [rows]="30" [totalRecords]="totalRecords" [loading]="loading" [globalFilterFields]="['order_id', 'firstName', 'mobile', 'totalSecurityDeposit', 'grandTotal', 'paymentStatus', 'delivery_status']">
                            <ng-template pTemplate="caption">
                              <div class="p-d-flex">
                                <span class="p-input-icon-left p-ml-auto">
                                          <!-- <i class="pi pi-search"></i> -->
                                          <input class="w-100" pInputText type="text" (input)="dt1.filterGlobal($event.target.value, 'contains')" placeholder="Search keyword" />
                                      </span>
                              </div>
                              <div class="flex">
                                
                                <button type="button" pButton pRipple icon="pi pi-file" (click)="dt1.exportCSV()" class="mr-2" pTooltip="CSV" tooltipPosition="bottom">CSV</button>
                                <button type="button" pButton pRipple icon="pi pi-file-excel" (click)="exportAsXLSX()" class="p-button-success mr-2"  pTooltip="XLS" tooltipPosition="bottom">XL</button>
                                <!-- <button type="button" pButton pRipple icon="pi pi-file-pdf" (click)="exportPdf()" class="p-button-warning mr-2" pTooltip="PDF" tooltipPosition="bottom"></button> -->
                                <button type="button" pButton pRipple icon="pi pi-filter" (click)="dt1.exportCSV({selectionOnly:true})" class="p-button-info ml-auto" pTooltip="Selection Only" tooltipPosition="bottom">XL</button>
                              </div>
                            </ng-template>
                            <ng-template pTemplate="header">
                                <tr>
                                  <th>
                                    <div class="flex justify-content-center align-items-center">
                                      Order Id
                                        <p-columnFilter type="text" field="order_id" display="menu"></p-columnFilter>
                                        <th pSortableColumn="order_id"><p-sortIcon field="order_id"></p-sortIcon></th>
                                    </div>
                                  </th>
                                  <th>
                                    <div class="flex justify-content-center align-items-center">
                                      Name
                                        <p-columnFilter type="text" field="firstName" display="menu"></p-columnFilter>
                                        <th pSortableColumn="firstName"><p-sortIcon field="firstName"></p-sortIcon></th>
                                    </div>
                                  </th>
                                  <th>
                                    <div class="flex justify-content-center align-items-center">
                                      mobile
                                        <p-columnFilter type="text" field="mobile" display="menu"></p-columnFilter>
                                        <th pSortableColumn="mobile"><p-sortIcon field="mobile"></p-sortIcon></th>
                                    </div>
                                  </th>
                                  <th>
                                    <div class="flex justify-content-center align-items-center">
                                      Product
                                        <p-columnFilter type="text" field="prod_name" display="menu"></p-columnFilter>
                                        <th pSortableColumn="prod_name"><p-sortIcon field="prod_name"></p-sortIcon></th>
                                    </div>
                                  </th>
                                  <th>
                                    <div class="flex justify-content-center align-items-center">
                                      Asset#
                                        <p-columnFilter type="text" field="asset_id" display="menu"></p-columnFilter>
                                        <th pSortableColumn="asset_id"><p-sortIcon field="asset_id"></p-sortIcon></th>
                                    </div>
                                  </th>
                                  <th>
                                    <div class="flex justify-content-center align-items-center">
                                      Renewal price
                                        <p-columnFilter type="numeric" field="renewal_price" display="menu" currency="INR"></p-columnFilter>
                                        <th pSortableColumn="renewal_price"><p-sortIcon field="renewal_price"></p-sortIcon></th>
                                    </div>
                                  </th>

                                  <th>
                                    <div class="flex justify-content-center align-items-center">
                                      Start date
                                        <p-columnFilter type="date" field="start_date" display="menu"></p-columnFilter>
                                        <th pSortableColumn="start_date"><p-sortIcon field="start_date"></p-sortIcon></th>
                                    </div>
                                  </th>
                                  
                                  <th>
                                    <div class="flex justify-content-center align-items-center">
                                      End date
                                        <p-columnFilter type="date" field="renewStatus" display="menu"></p-columnFilter>
                                        <th pSortableColumn="renewStatus"><p-sortIcon field="renewStatus"></p-sortIcon></th>
                                    </div>
                                  </th>
                                </tr>
                            </ng-template>
                            <ng-template  pTemplate="body" let-rowData let-o>
                                <tr [pSelectableRow]="rowData" [ngClass]="o.request_status==1 ? 'bg-danger text-white':''">
                                  <td [routerLink]="['../../sales/orders',o.order_id]">{{o.order_id}}</td>
                                  <td [routerLink]="['../../users/customers',o.customer_id]">{{o.firstName}}{{o.lastName}}</td>
                                  <td [routerLink]="['../../users/customers',o.customer_id]">{{o.mobile}}</td>
                                  <td>{{o.prod_name}}</td> 
                                  <td>{{o.asset_id}}</td> 
                                  <td>{{o.renewal_price}}</td>
                                  <td>{{o.start_date | date: 'dd MM yyyy'}}</td>    
                                  <!-- <td>{{o.end_date | date: 'dd MM yyyy'}}</td> -->
                                  <td>{{o.renewStatus}}</td>
                                </tr>
                            </ng-template>
                        </p-table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Container-fluid Ends-->

    <!-- <ng-template #content let-c="close" let-d="dismiss">
        <div class="modal-header text-center">
          <h4 class="col-12 modal-title text-center" id="modal-basic-title">Update order & refund status</h4>
          <button type="button" class="close" aria-label="Close" (click)="d()">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <div class="row">   
                <form enctype="multipart/form-data" [formGroup]="updateStatus" (ngSubmit)="updateDeliveryStatus(orderId)">
                               
                <div class="col">
                    <label>Update Delivery Status</label>
                        <select formControlName="deliveryStatus">
                            <option>Order booked</option>
                            <option>Renewed</option>
                            <option>Waiting for KYC</option>
                            <option>Delivered</option>
                            <option>Shipped</option>
                            <option>Returned</option>
                            <option>Delivery awaited</option>
                            <option>Partially delivered</option>
                        </select>                        
                </div>
                <div class="col">
                    <label>Update payment Status</label>
                    <select formControlName="refundStatus">
                            <option>awaiting payment</option>
                            <option>Paid</option>
                            <option>Deposit refunded</option>
                            <option>Complete refund</option>
                            <option>Refund initiated</option>
                    </select>
                </div>
                
                <button type="submit">Update</button>
            </form>
            </div>
        </div>
    </ng-template> -->
<!-- 
    <ng-template class="order-details" #orderDetails let-c="close" let-d="dismiss">
        <div class="modal-header text-center">
          <h4 class="col-12 modal-title text-center" id="modal-basic-title">Order details</h4>
          <button type="button" class="close" aria-label="Close" (click)="d()">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <div class="row" *ngFor="let o of fullOrderDetails">          
                <div class="col">
                    <h3>Order details</h3>

                    <table class="table table-striped table-bordered" >
                        <thead>
                          <tr>
                            <th>Order Id</th>
                            <th>Payu Trans Id</th>
                            <th>User Id</th>
                            <th>Order date</th>
                          </tr>
                        </thead>
                        <tbody *ngFor="let o of fullOrderDetails">
                          <tr>
                            <td>{{o.txnid}}</td>
                            <td>{{o.payuid}}</td>
                            <td>{{o.userId}}</td>
                            <td>{{o.orderdate}}</td>                         
                          </tr>                          
                        </tbody>
                      </table>

                    <h3>Product details</h3>
                    <table class="table table-striped table-bordered" *ngFor="let o of fullOrderDetails">
                        <thead>
                          <tr>
                            <th>prod id</th>
                            <th>Prod name</th>
                            <th *ngIf="o.order_type!='Renewal order'">Qty</th>
                            <th *ngIf="o.order_type!='Renewal order'">Tenure</th>
                            <th *ngIf="o.order_type!='Renewal order'">Security Deposit</th>
                            <th>Rent/mo</th>
                            <th *ngIf="o.order_type!='Renewal order'">Expected Delivery Date</th>
                            <th *ngIf="o.order_type!='Return order'">Start date</th>
                            <th *ngIf="o.order_type!='Return order'">Expiry date</th>
                            <th *ngIf="o.order_type!='Return order'">Due date</th>
                            <th *ngIf="o.order_type=='Return order'">Return date</th>
                            <th>Asset #</th>
                          </tr>
                        </thead>
                        <tbody *ngFor="let p of o.checkoutItemData">
                          <tr *ngIf="p.ordered==1 && o.order_type=='Primary order'">
                            <td>{{p.id}}</td>
                            <td>{{p.prod_name}}</td>
                            <td>{{p.qty}}</td>
                            <td>{{p.tenure}}</td>
                            <td>₹{{p.prod_price}}</td>
                            <td>₹{{(p.price-0) + (p.dp-0)}}</td>
                            <td>{{p.delvdate}}</td> 
                            <td>{{p.startDate}}</td>
                            <td>{{p.expiryDate}}</td>
                            <td>{{dueDate(p.startDate)}}</td>
                            <td>{{p.assetId}}</td>                                                       
                          </tr>           
                          <tr *ngIf="p.renewed==4 && o.order_type=='Renewal order'">
                            <td>{{p.id}}</td>
                            <td>{{p.prod_name}}</td>
                            <td>₹{{(p.price-0) + (p.dp-0)}}</td>
                            <td>{{p.startDate}}</td>
                            <td>{{p.expiryDate}}</td>
                            <td>{{dueDate(p.startDate)}}</td>
                            <td>{{p.assetId}}</td> 
                                                      
                          </tr>   
                          <tr *ngIf="p.ordered==1 && o.order_type=='Replacement order'">
                            <td>{{p.returnedProduct.id}}</td>
                            <td>{{p.returnedProduct.prod_name}}</td>
                            <td>{{p.returnedProduct.qty}}</td>
                            <td>{{p.returnedProduct.tenure}}</td>
                            <td>₹{{p.returnedProduct.prod_price}}</td>
                            <td>₹{{(p.returnedProduct.price-0) + (p.returnedProduct.dp-0)}}</td>
                            <td>{{p.returnedProduct.delvdate}}</td> 
                            <td>{{p.returnedProduct.startDate}}</td>
                            <td>{{p.returnedProduct.expiryDate}}</td>
                            <td>{{dueDate(p.returnedProduct.startDate)}}</td>
                            <td>{{p.returnedProduct.assetId}}</td>                                                       
                          </tr>  
                          <h5 *ngIf="p.ordered==1 && o.order_type=='Replacement order'">Replaced product</h5>
                          <tr *ngIf="p.ordered==1 && o.order_type=='Replacement order'">
                            <td>{{p.id}}</td>
                            <td>{{p.prod_name}}</td>
                            <td>{{p.qty}}</td>
                            <td>{{p.tenure}}</td>
                            <td>₹{{p.prod_price}}</td>
                            <td>₹{{(p.price-0) + (p.dp-0)}}</td>
                            <td>{{p.delvdate}}</td> 
                            <td>{{p.startDate}}</td>
                            <td>{{p.expiryDate}}</td>
                            <td>{{dueDate(p.startDate)}}</td>
                            <td>{{p.assetId}}</td>                                                       
                          </tr> 
                          <tr *ngIf="o.order_type=='Return order'">
                            <td>{{p.id}}</td>
                            <td>{{p.prod_name}}</td>
                            <td>{{p.qty}}</td>
                            <td>{{p.tenure}}</td>
                            <td>₹{{p.prod_price}}</td>
                            <td>₹{{(p.price-0) + (p.dp-0)}}</td>
                            <td>{{p.delvdate}}</td> 
                            <td>{{p.returnDate}}</td>
                            <td>{{p.assetId}}</td>                                                       
                          </tr>               
                        </tbody>
                    </table>

                    <div *ngFor="let o of fullOrderDetails" class="pull-right">
                        <div *ngIf="o.order_type!='Replacement order'">
                          <h4>Sub total: ₹{{subTotal}}</h4>
                          <h4>Taxes: {{totalTaxAmount(subTotal)}}</h4>
                          <h4>Total security deposit: <span>₹{{o.securitydeposit}}</span></h4>
                          <h4>Grand Total: <span>₹{{o.amount}}</span></h4>
                        </div>
                        <div *ngIf="o.order_type=='Replacement order'">
                          <h4>Difference rent: ₹{{diffInRent}}</h4>
                          <h4>Damage / Delivery Charges: {{ddCharges}}</h4>
                          <h4>Taxes: {{totalTaxAmount(diffInRent+ddCharges)}}</h4>
                          <h4>Sub total: {{diffInRent+ddCharges+totalTaxAmount(diffInRent+ddCharges)}}</h4>
                          <h4>Difference security deposit: <span>₹{{diffInDeposit}}</span></h4>
                          <h4>Grand Total: <span>₹{{o.amount}}</span></h4>
                        </div>
                    </div> 
                    
                    <div class="addr">
                        <hr>
                        <h3>Billing Address</h3>
                        <div *ngFor="let o of fullOrderDetails">
                            <h4>Name: <span>{{o.fname}}</span></h4>
                            <h4>Address: <span>{{o.address}},{{o.city}}-{{o.pincode}}.</span></h4>
                            <h4>Mobile: <span>{{o.mobile}}</span></h4>
                            <h4>Email: <span>{{o.email}}</span></h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </ng-template> -->